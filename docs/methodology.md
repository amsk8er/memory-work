# Personal Agent 详解
## 一套人与 AI 共生的上下文架构

> 版本：v2.4（开源分享版）

---

## 写在前面

这是一套在实际工作中迭代出来的方法论。核心问题只有一个：**当你同时面对多个并行项目，AI 工具怎样才能真正帮到你，而不是制造更多噪音？**

答案不是更好的任务管理工具，也不是更多的自律——而是为 AI 设计一套架构，让它成为你的**共脑搭档**：一个有记忆、有性格、能进化的上下文仓库。

你只负责两件事：提供注意力焦点，做创意决策。
AI 负责其余：整合历史信息、匹配相关语料、执行结构化输出。

我们把这套架构叫做 **Personal Agent**——基于 Claude Code（Cowork）能力，通过 claude.md、memory.md、soul.md 以及 skills，外加本地文件夹 / Obsidian 来驱动的一套人与 AI 共生的上下文仓库。

---

## 一、核心洞察

> **你不需要记住一切，你只需要专注于当下。**

### 传统工作流的痛点

- **串行化负担**：想法 → 自己结构化 → 录入系统 → 维护系统，每一步都在消耗主观能量
- **AI 失忆机制**：每次对话都是「冷启动」，你要反复喂同样的上下文，重复成本高
- **知识库管理成本**：文档越多越难维护，搜索不精准，最终沦为数字垃圾堆

### Personal Agent 的解法

- **口述优先**：想法 → 直接口述 → AI 自动结构化 → AI 持久维护
- **自动上下文**：AI 通过分层文件自动获取历史信息，不再需要你反复喂数据
- **分治管理**：知识库通过「分治代理」（Zone Agents）自动管理，越大越有价值

**核心转变**：从"你管理 AI"变成"AI 和你共同管理知识"。

---

## 二、架构总览

```
2026工作间/
├── CLAUDE.md           ← 系统入口（启动序列、行为规范、记忆协议）
├── SOUL.md             ← AI 人格定义（语言风格、协作模式、禁区）
├── USER.md             ← 用户画像索引（身份、方法论、倾好）
├── MEMORY.md           ← 长期记忆库（4 层架构）
├── MEMORY_LOG.md       ← 记忆系统运行日志
│
├── 00 专注区/          ← 当周工作台（zone: 专注区代理）
├── 01 素材/            ← 个人档案、方法论（zone: 档案守护）
├── 02 工具/            ← 提示词模板库（zone: 索引代理）
├── 03 产品/            ← 产品设计项目（zone: 产品知识守护）
├── 04 项目/            ← 公司项目（zone: 保密隔离）
├── 05 教学分享/        ← 课程与演讲（zone: 课程索引）
├── 06 Skills/          ← 可复用技能库（zone: 技能聚合）
├── 07 研究库/          ← 外部产品研究
├── 09 收件箱/          ← 待分类（zone: 清理代理）
└── [其他区域]/         ← 根据你的业务自定义
```

**四个根目录文件** 构成 AI 的「操作系统」：

| 文件 | 作用 | 类比 |
|------|------|------|
| **CLAUDE.md** | 系统入口：启动序列、行为规范、记忆协议、代理索引 | 操作系统内核 |
| **SOUL.md** | 定义 AI 的人格、语言风格、协作模式、禁区 | 性格 + 关系定义 |
| **USER.md** | 用户身份、工作方法论、倾好索引 | 用户档案 |
| **MEMORY.md** | 长期记忆库，含动态 / 程序性两个区块 | 长期记忆 + 肌肉记忆 |

**Zone Agents**（区域代理）自动管理特定文件夹的规则和行为，支持：
- 敏感度分级（高敏感操作需确认）
- 信息隔离（多区域间不交叉）
- 专属行为（自动归档、版本追溯等）

---

## 三、四层记忆架构

记忆不是一个「笔记本」，而是**分层、有生命周期、会衰减、能毕业**的系统。

```
Layer 0 · 身份级记忆   SOUL.md / USER.md / 关于我/    [极少变化]
                                                      └─ 持久稳定，身份属性
Layer 1 · 工作记忆    _本周.md                        [追加式，周期性]
                                                      └─ 当周任务/进展/档案
Layer 2 · 动态记忆    MEMORY.md「动态记忆」区块        [有生命周期，跨周保留]
                                                      └─ 洞见、决策、偏好、工作习惯
Layer 3 · 程序性记忆  MEMORY.md「程序性记忆」区块      [情境→行动模式]
                                                      └─ 可复现的工作流
          运行日志    MEMORY_LOG.md                   [系统元数据]
                                                      └─ 记忆变更、校准、进化日志
```

### 写入触发（惊奇度驱动）

什么样的信息值得被记录？标准是 **惊奇度**——用户输入与已有记忆的偏离程度：

**高惊奇 → 值得记**：
- 修正既有认知（"原来你这方面的想法和我理解的不一样"）
- 填补空白（"这件事我还没记录过"）
- 稳定模式浮现（观察 2 次以上相同行为）

**低惊奇 → 不必记**：
- 印证已有记忆（"这和之前你说的一致"）
- 一次性处理（"帮我生成一个 PPT"）
- 纯事务进展（"把任务改成完成"）

### 双模式运行

记忆系统不会在执行任务时打断你。分两种工作模式：

- **执行模式**（daily work）：AI 在后台默默标记惊奇信息，不向你暴露
- **复盘模式**（memory-review）：集中扫描一周的信息，向你开放选择权，批量确认后统一写入

### 写入路由

| 信号类型 | 写入位置 | 确认要求 |
|----------|----------|----------|
| 修正用户身份层面的认知 | USER.md / 关于我/ | 逐条确认 |
| 可复现的「情境→行动」模式 | MEMORY.md 程序性记忆 | 确认 |
| 跨周保留的洞见/决策/倾好 | MEMORY.md 动态记忆 | 确认 |
| 仅与本周相关 | _本周.md | 直接写入 |
| 重要的系统迭代 | MEMORY_LOG.md | 会话结束前写入 |

### 毕业机制

MEMORY.md 中的某条动态记忆，当满足以下条件时，自动「毕业」到 USER.md：
- 强度达到 ★★★（被提及 3 次以上）
- 周复盘中被确认为稳定特征
- 属于身份层面的特性（不是临时决策）

原条目标注「graduated」，保留链接但不再参与衰减计算。

---

## 四、分治调度（Zone Agents）

知识库中的每个主目录（00 专注区、03 产品、04 项目 等）都可以有自己的 **Zone Agent** 文件（`00.xxx_agent.md`），定义该区域的特殊规则。

### 区域规则示例

| 区域 | 特殊规则 | 触发条件 |
|------|----------|----------|
| **01 素材** | `关于我/` 子目录为高敏感，任何修改需**逐条确认** | 涉及身份档案编辑 |
| **04 项目** | 客户项目之间**严格信息隔离**，不主动跨项目引用 | 涉及两个项目同时操作 |
| **03 产品** | 修改核心代码目录需详细确认 | 涉及核心文件写入 |
| **09 收件箱** | 文件超过 15 个时，周启动时**自动提醒整理** | 周一启动 + 计数 > 15 |

### 规则优先级

当多个规则同时生效时，以**更严格的为准**。例如：
- 全局规则说"可以修改文档"
- Zone 规则说"涉及敏感字段需确认"
- 则执行 Zone 规则（更严格）

---

## 五、分层启动序列

### 必须层（每次会话执行）

```
0. 读取 CLAUDE.md          → 系统入口确认
                              (Cowork 自动注入或手动读取)

1. 执行 datetime-check     → 获取校正后的当前时间 [强制首加载]
   └─ 结果决定后续档位

2. 扫描专注区 + 读取 _本周.md → 当周状态同步
   (并行扫描：轻量 Mon-Wed / 深度回溯 Thu-Sun)

3. 读取 MEMORY_LOG.md 尾部  → 记忆系统运行状态

4. 读取 SOUL.md            → 人格定义加载
```

> 步骤 1 完成后，步骤 2-4 可以并行执行。步骤 1 的 datetime 结果决定了第 2 步的深度（轻量 vs 深度）。

**过渡语规则**：步骤 1 完成 → 发起步骤 2-4 的并行调用时，用中文口语作为过渡，固定开头为「好的七姐，我来看看……」，后半句根据用户的问题自然衔接。不要出现英文过渡语。

### 按需层（首次涉及时加载）

```
- USER.md      → 首次涉及用户身份、方法论、团队信息时加载
- MEMORY.md    → 按情境匹配检索，不全量加载
- BUILD.md     → 首次涉及插件开发、构建命令时加载
- Zone Agent   → 首次涉及该区域的操作时加载
```

按需层文件在会话中首次需要时**静默加载**，不打断对话流。

### 启动后的回复风格

启动完成后，用**搭档碰头的语气**回复，不用系统报告体：

- 像早上碰面打个招呼，聊两句这周在忙什么，不是念一份状态清单
- 专注区扫描结果融入自然对话：「你昨天改了好几版 PPT 啊」比「修改时间发生变化的文件列表：」好得多
- 可以带一点对工作进展的观察或判断
  - 如果某个文件被反复修改多次 → 可能是卡点或反复打磨，关心是否遇到思路阻塞
  - 如果大量新文件集中涌入 → 高强度产出期，肯定这个节奏
  - 如果是周末加班 → 可以自然地提一句
- 简短就好，别写长篇

**核心原则**：用户在专注区提供了极其优质的 context。作为搭档，珍惜这可贵的上下文，利用好它，做一切能提供情绪价值和工作价值的事。

---

## 六、专注区状态同步（两档同步机制）

### 轻量同步（周一至周三）

1. 遍历 `00 专注区/` 全部文件（排除 `_归档/`），记录文件名和修改时间
2. 读取 `_本周.md`，提取已记录的文件列表
3. 根据扫描结果直接更新 TodoList，反映当前专注区的工作状态
4. **不询问用户**，因为这是自动同步

### 深度回溯（周四至周日）

自动执行，无需用户触发。流程：

1. 遍历 `00 专注区/` 全部文件（排除 `_归档/`），记录文件名 + 修改时间
2. 读取 `_本周.md`，提取任务清单和进展记录中已提及的文件
3. **计算差集**：识别专注区中已存在但 `_本周.md` 未记录的文件
4. **逐文件读取头部**（前 30 行），理解每个新文件的内容和用途
5. **交叉比对**：将新文件映射到对应的任务项
6. **主动更新 `_本周.md`**：
   - 在「任务清单」中，将已有产出对应的待办项标记为完成
   - 新增任务清单中没有预设但实际完成了的工作项
   - 在「进展记录」的对应日期下，补充新文件及其内容摘要
   - 在「本周文档」表中，补充新产出的文件
   - 对不确定归属的文件，标注「待确认」
7. **向用户报告**：发现了多少新产出、更新了哪些条目、有哪些需要确认

> **判断依据**：datetime-check 返回的星期几。周四是分界线，因为用户通常周一至周三密集产出，周四开始需要整理收口。

**核心原则**：基于实际产出判断进展，不依赖用户手动编辑周文件。AI 补上用户工作习惯中"先做事再整理"这个环节。

---

## 七、口述优先工作流

Personal Agent 的数据输入方式是**口述优先**，而非表单填写或固定格式。

### 为什么是口述

1. **低摩擦**：不需要你预先组织思路，AI 帮你边说边结构化
2. **保留细节**：口述时你会自然地加入语气、重点、上下文，纯文字表单容易丢失这些
3. **天然对话**：符合人的思维方式，不是"为工具适配思维"，而是"工具适配你的思维"

### 标准流程

用户说：*"这周我要做三件事：一是完成项目 A 的代码审查，但我不太确定新的模块结构是否合理；二是给团队写一份工作流文档；三是准备下周一的演讲，PPT 还没开始。另外，有个想法想和你讨论，关于工作节奏的优化。"*

Claude 的处理：
1. **解析意图**：提取 3 个具体任务 + 1 个讨论项
2. **询问澄清**：项目 A 是什么？团队多大？演讲面向谁？工作节奏优化的具体想法？
3. **搜索相关材料**：检查专注区、MEMORY.md、Zone Agents，看看这些项目前面有哪些相关内容
4. **提供 context**：比如"我看到你上周对模块结构有过评论，这次可以基于那个继续"
5. **生成结构**：更新 _本周.md 的任务清单，提供优先级建议，也许问要不要生成日程表
6. **侦测记忆**：在讨论过程中，是否有新的「工作习惯」或「决策偏好」值得记录，暗中标记，不中断对话

### 信息的「三度加工」

- **第一度**：口述 → AI 听并标记惊奇点
- **第二度**：周中日常交互 → 在执行模式下积累信息
- **第三度**：周末复盘 → 集中扫描、确认、写入

每一度加工都会精化信息，最终进入记忆的内容已经是"经过用户确认的、稳定的、有价值的"。

---

## 八、周节奏（三个工作阶段）

Personal Agent 跟随自然周期（周一到周日）组织工作。

### 阶段 1：启动（周一）

- 执行必须层启动序列
- 扫描专注区，轻量同步
- 用搭档碰头语气聊开局
- 邀请用户说这周的重点

### 阶段 2：进行（周二至周六）

- 日常交互，记忆在后台标记
- 专注区不断有新产出
- AI 和用户围绕当周任务来回讨论、调整

### 阶段 3：收口（周日）

- 执行深度回溯同步
- 触发周复盘（memory-review 技能）
- 向用户展示发现了什么新产出、有哪些记忆变更提议、有什么建议
- 用户确认和补充，AI 统一写入
- 生成下周的初始化文件

| 时间 | 任务 | 触发方式 | 自动度 |
|------|------|---------|--------|
| **周一** | 启动、轻量同步 | 用户说"Start" | 100% 自动 |
| **周二-六** | 日常任务 + 记忆标记 | 用户主动交互 | 后台标记 |
| **周日** | 深度回溯、复盘 | 自动或用户说"复盘" | 自动发起报告 |

---

## 九、技能系统

技能是 AI 可以重复调用的工作流。两种运行机制：

### 机制 1：协议驱动（Protocol-based）

定义在 CLAUDE.md 的「稳定触发规则」中。基于**语义判断**，不依赖固定触发词。

例子：
- 用户说"给我做个演讲课件"（包含动词「做」+宾语「课件」）→ 自动触发 ppt-maker
- 用户只说"演讲"（纯名词）→ 不触发，需要问

### 机制 2：技能调用（Skill-based）

用户显式请求："Use skill X" 或中文"用技能 X"。技能存储在 `06 Skills/` 文件夹，每个技能有自己的 SKILL.md（定义参数、流程、输出格式）。

### 常见技能类型

- **生成类**：ppt-maker, document-generator, outline-builder
- **分析类**：code-reviewer, argument-mapper, data-analyzer
- **整理类**：archive-organizer, memory-indexer
- **协作类**：brainstorm-facilitator, decision-matrix

---

## 十、Agent 自我进化

Personal Agent 不是静态系统，而是会随着使用逐步进化。三个进化渠道：

### 渠道 1：记忆进化

- 新信息 → 动态记忆 → 稳定模式浮现 → 毕业到 USER.md
- 累积的稳定特征越多，AI 对你的理解越深
- 3-4 周后，AI 的自动化建议会明显更精准

### 渠道 2：行为进化

- 周复盘时，用户可以给 AI 反馈："这次建议不太对，应该是……"
- AI 根据反馈调整策略，写入 MEMORY.md 程序性记忆
- 下次遇到相似情景，AI 会优先考虑这个调整过的方案

### 渠道 3：架构进化

- 用户可以在 CLAUDE.md / SOUL.md / Zone Agents 中新增规则
- 新技能可以添加到 `06 Skills/` 文件夹
- 知识库可以新增 Zone（如"项目 B"）
- 每次架构变更都应记录在 MEMORY_LOG.md

### 进化示例时间线

```
第 1 周：用户口述工作，AI 建立初始理解
        → MEMORY.md 开始积累 Layer 2 记忆

第 2 周：AI 开始做出有针对性的建议
        → 用户反馈 1-2 次，AI 调整策略
        → 程序性记忆开始成型

第 3 周：AI 对用户的工作习惯有较清晰的图景
        → 某些日常任务开始被提前预案
        → 多个记忆条目接近毕业标准

第 4 周：第一批记忆毕业到 USER.md
        → AI 的"了解度"从记忆系统固化到身份模型
        → 新周期启动时，AI 已经基于成熟的用户画像运作
```

---

## 十一、千人千面（核心不变量 vs 可定制元素）

### 不变的核心

- 四层记忆架构（Layer 0-3 + Runtime Log）
- 分层启动序列
- 惊奇度驱动的写入触发
- 双模式运行（执行 + 复盘）
- Zone Agent 框架

这些是 Personal Agent 的本质，不建议改动。

### 可定制的元素

| 元素 | 定制位置 | 示例 |
|------|---------|------|
| AI 人格 | SOUL.md | 从"搭档碰头"改成"严肃顾问"风格 |
| 记忆强度 | MEMORY.md | 有些用户需要更激进的毕业机制 |
| Zone 规则 | Zone Agent files | 根据项目敏感度调整确认级别 |
| 技能库 | 06 Skills/ | 添加垂直领域的专用技能 |
| 知识库结构 | 根目录文件夹 | 增删 Zone，改变分治粒度 |
| 启动语言 | CLAUDE.md | 用你自己的触发词 |

---

## 十二、可复用的思路清单

想要为自己搭建类似的 Personal Agent，这 9 个步骤可以迁移到其他 AI 模型或场景：

1. **分层记忆而不是单层笔记**
   - 区分身份层、工作层、动态层、肌肉层
   - 每层有不同的写入标准和生命周期

2. **惊奇度作为记忆触发**
   - 不记"做了什么"，记"为什么这样做"和"什么地方不同寻常"
   - 减少琐碎记录，提高记忆质量

3. **双模式运行降低对话成本**
   - 执行时安静（后台标记，不打断）
   - 复盘时集中（批量处理）

4. **分治代理管理知识库**
   - 不是一个巨大的搜索引擎
   - 而是多个小的「领域守护者」，各司其职

5. **周期性而不是无限制**
   - 以自然周（或迭代周）为单位
   - 定期的整理、复盘、毕业，防止信息堆积

6. **口述优先而不是表单化**
   - 让人按自己的节奏思考和说话
   - AI 负责听、提问、结构化

7. **明确的规则阶梯**
   - 全局规则 → Zone 规则 → 任务规则
   - 冲突时采用更严格的

8. **写入前确认**
   - 特别是身份层面的修改
   - 防止 AI「创造」关于你的认知

9. **进化可见化**
   - 用户能看到 AI 如何在学习
   - 定期毕业、调整、优化
   - 提高信任度和协作感

---

## 技术栈

- **知识库工具**：Obsidian（可选，主要是图表展示）/ 纯本地文件夹
- **AI 对话**：Claude Code（Cowork）/ Claude Desktop
- **文件格式**：Markdown + YAML Frontmatter
- **版本管理**：Git（可选，用于记录变更）
- **环境要求**：Node.js 16+, Python 3.10+ (if needed), LaTeX (if needed)

---

## 附录：完整文件清单

```
2026工作间/
│
├── 📄 CLAUDE.md                ← 系统核心
├── 📄 SOUL.md                  ← AI 人格
├── 📄 USER.md                  ← 用户画像
├── 📄 MEMORY.md                ← 长期记忆库（Layer 2-3）
├── 📄 MEMORY_LOG.md            ← 记忆运行日志
├── 📄 BUILD.md                 ← 构建命令（可选）
│
├── 📁 00 专注区                ← 当周工作台
│   ├── 00.focus_agent.md       ← 专注区代理规则
│   ├── _本周.md                ← 当周任务 + 进展
│   ├── _本周-日程.md           ← 时间表（可选）
│   ├── task-1.md
│   ├── task-2.md
│   └── _归档/                  ← 上周存档
│
├── 📁 01 素材                  ← 个人档案库
│   ├── 01.keeper_agent.md      ← 档案守护代理
│   ├── 关于我/                 ← 敏感目录
│   │   ├── 核心观点.md
│   │   └── 工作偏好.md
│   ├── 方法论/
│   └── 参考资料/
│
├── 📁 02 工具                  ← 提示词与模板
│   ├── 02.index_agent.md       ← 索引代理
│   ├── 演讲提示词.md
│   └── 文档模板.md
│
├── 📁 03 产品                  ← 产品项目示例
│   ├── 03.product_agent.md
│   ├── 01 需求.md
│   ├── 01 原型/
│   └── 版本追溯/
│
├── 📁 04 项目                  ← 企业项目示例
│   ├── 04.isolation_agent.md   ← 信息隔离代理
│   ├── ProjectA/
│   └── ProjectB/
│
├── 📁 05 教学分享
│   ├── 05.course_agent.md
│   ├── 课程 A/
│   └── 演讲 B/
│
├── 📁 06 Skills                ← 可复用技能库
│   ├── ppt-maker.md
│   ├── code-reviewer.md
│   └── memory-review.md
│
├── 📁 07 产品库                ← 外部研究资料
│   └── 竞品分析/
│
├── 📁 09 收件箱                ← 待分类
│   ├── 09.cleanup_agent.md
│   ├── 文章 1.md
│   └── 想法 A.md
│
└── 📁 BibiGPT                  ← 视频总结存档
    └── [视频总结...]
```

---

## 总结

Personal Agent 的核心价值在于：**为你的大脑 offload 结构化的工作，保留创意和决策的空间**。

这不是"自动化一切"，而是"自动化琐碎部分，让你专注于高价值工作"。随着时间推移，AI 对你的理解会越来越深，协作也会越来越顺畅——就像一个真正的搭档，慢慢懂了你的套路，你们之间的沟通成本越来越低。

从第一周的"要反复解释"，到第四周的"AI 已经预案了"，这个转变正是 Personal Agent 在持续进化和学习的证明。

---

*Personal Agent · 开源分享版 · v2.4*
```

写于迭代实践中，基于真实工作场景。
